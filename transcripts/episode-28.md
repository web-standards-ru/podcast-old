# Выпуск №28

8 августа 2016: Новинки браузеров, триумф EdgeHTML 14, будущее сервис-воркеров, чистый и безопасный SVG, заливка текста и адаптивная вёрстка.

- Ольга Алексашенко
- Вадим Макеев
- Алексей Симоненко

## Чистый SVG

**Вадим.** На этой неделе была пара интересных статей про SVG. Первая от Сары Дрэснер. Она [в блоге CSS-Tricks опубликовала](https://css-tricks.com/high-performance-svgs/ "High Performance SVGs") способ, или даже не способ, а вообще подход к тому, как нужно работать с SVG, чтобы они были быстрыми. Грубо говоря — кривые должны быть чистыми, чтобы в них не было мусора. Когда мы оптимизируем с помощью какого-нибудь SVGO, мы пытаемся работать с существующей информацией. Мы можем каким-то образом комбинировать кривые. Мы можем вычищать всякие лишние теги, которые не оказывают никакого влияния на финальный рендеринг. Но почистить кривые автоматически — сложновато. Их нужно рисовать чистыми.

**Лёша.** Я, кстати, хочу рассказать о проблеме с дизайнерами и с SVG. Мы пока делали новый сайт, нам ребята нарисовали много-много SVG, ну прямо совсем много. И главная проблема оказалась такая, которая вроде даже не вылезает на первый план. Дело в том, что многие дизайнеры рисуют ручную рисовку. Это не когда мы мышкой возим, делаем прямоугольнички, и так далее, а когда пытаемся именно рисовать рукой. Они же берут перо и планшет, по которому они возят. Проблема в том, что, когда вы рисуете в векторе, каждый ваш штрих ставит точки, очень много точек. Вы вроде рукой так хорошо и красиво водите, вам кажется, что линия прямая, а на ней будет сотня точек. Вы этого даже не заметите. В этом главная проблема, когда вы рисуете иконки.

Мы с этим столкнулись и научили наших дизайнеров с этим справляться. Во-первых, чтобы они обращали внимание на то, что очень важен итоговый размер, что это не просто картинка, а нужно посмотреть в код, всё ли там оптимально. Да или вообще просто включить все эти невидимые элементы и посмотреть — это вообще нормально там или нет.

Но более того. Когда дизайнер рисует прямую или кусочек окружности, да или окружность пером (дизайнеры всё-таки пером рисуют), из-за того, что у него может рука чуть-чуть шелохнуться, он не нарисует чистую прямую или окружность. Точнее она будет выглядеть и казаться чистой, но это будет тот же самый `path`, а не какой-нибудь `circle` или `poligon`, и так далее. И дизайнер этого даже не увидит. А это совсем не оптимальная форма этого объекта для SVG. Если нас слушают дизайнеры, которые рисуют SVG, я бы очень советовал смотреть, что получается в итоге, особенно если вы рисуете пером.

И здесь, на CSS-Tricks я увидел ещё один интересный момент. Как я понимаю, это Illustrator всё-таки, и в нём есть такой инструмент как Reduce Path Point. Им можно упростить формы, которые вы нарисовали. Это по идее тоже позволит вам уменьшить количество точек. Но даже с этим инструментом я бы всё равно смотрел глазами. Иначе получается очень неоптимальный SVG, и это потом боль всем верстальщикам.

**Вадим.** Кстати, если говорить про `path`, `circle` и так далее, я тут где-то прочитал, что на самом деле все эти `circle`, `line` и все остальные — это просто псевдонимы к `path`. То есть, этот SVG-элемент `path`, он на самом деле может представить любую фигуру, но для того, чтобы нам было проще кодить руками, можно использовать дополнительные псевдонимы в виде `circle`, `rectangle` и так далее.

**Лёша.** Ну это понятно, да. Но просто в `path` могут быть лишние точки, которых ты не увидишь. А в том же самом `circle` всё абсолютно конкретно. Ты задаёшь только радиус и координаты центра. И всё.

**Вадим.** На самом деле, разница между теми, кто возюкает кисточкой и теми, кто рисует кривые исключительно в квалификации на мой взгляд. Просто есть фотошоперы, которые рисовали кисточкой, корректировали фотографии с помощью растровой кисточки. Они не особо понимают, как рисовать вектор. Нормальный чистый вектор люди рисуют не кисточкой. И даже дело не в пере. Тем же самым пером вполне себе можно рисовать по точкам. То есть кликать и рисовать кривые Безье. Речь пожалуй о квалификации. Поэтому если ваш дизайнер умеет рисовать в векторе хорошо, а не просто рисует векторные фигуры растровыми способами — значит вам повезло. Если нет — научите. Покажите вашим дизайнерам статью Сары Дрэснер, и научите их оптимизировать SVG. Один из интересных способов, про которые рассказала Сара — это убирать фон. Когда рисуете вы фигуры периодически складываете, разбиваете на части и у вас получаются лишние элементы которые можно заменить, например, одной фоновой картинкой.

Никто не предлагает дизайнерам делать идеальный код в итоге, потому что задача дизайнеров рисовать, ну или проектировать, смотря какой дизайнер. Но это базовые приёмы чистоты. Если раньше мы говорили про то, что в Photoshop слои нужно именовать, то и в Illustrator в общем-то тоже можно слои именовать, и айдишники расставлять элементам, особенно если потом анимировать. И вот теперь ещё одна история, связанная с тем, что кривые должны быть чистыми. Я думаю очень полезный урок дизайнерам. И даже верстальщикам, потому что иногда кривые нарисованы, и остаётся только верстальщику оптимизировать.

**Лёша.** Ну да, это точно должен знать и верстальщик тоже. Но я ещё один момент вспомнил. Понимаешь, не то что бы дизайнер неграмотный, просто появляется много разных технологий. И не то что бы весь этот веб прямо так очень нужен всем дизайнерам. Мы конечно все говорим о том, что дизайнер обязательно должен понимать, как всё будет работать. Но не все же такие. И понятно, надо образовывать дизайнеров в том числе. У нас ведь был растр, где в принципе сколько движений кистью не сделаешь — оно всё слепится в одну картину, сколько ты слоёв друг на друга ни наложишь — они все слепятся в один. А в векторе, например, рисуешь что-то, нарисовал круг, залил его фоном, потом сверху нарисовал ещё что-то, потом ещё сверху нарисовал что-то, потом перекрыл кусок каким-нибудь квадратом и так далее. И получается картина, в которой можно было бы нарисовать линию и какую-то заливку в каком-то квадрате, но не делать всех операций, которые накладываются друг на друга. И проблема вектора в том, что он ведь хранит все эти слои: первый слой, потом что-то наложили сверху, потом ещё что-то наложили сверху. И это совсем не то, как картина выглядит в итоге. Все эти махинации будут лежать в SVG-файле и в этом проблема. У нас были случаи, когда у дизайнера были какие-то вещи, которые заходили за артборд — это просто пример типичной ситуации. Вот как ты берёшь бумажку и карандаш и начинаешь там чирикать, потом чирикать сверху, и так далее — вот и пером ровно так же они работают. Это не плохой, это хороший способ работать. Но потом обязательно должен быть этап, когда ты это всё оптимизируешь.

**Вадим.** Оля, а у вас дизайнеры образованные в этом смысле?

**Оля.** Ну как сказать. Наши дизайнеры нам как правило SVG не отдают. То есть, есть в PSD какие-то элементы, которые являются векторными объектами, и их можно экспортировать при помощи самого Photoshop. Но к сожалению экспорт Photoshop какой-то чудовищный. Каждый раз, когда я пыталась это сделать, я на выходе получала SVG не с `path` внутри, а объект, и в нём в `base64` вставлен код картинки. Это абсолютно неюзабельно.

**Лёша.** По-моему, это не проблема экспорта Photoshop, это проблема того, как дизайнер эти элементы сделал.

**Оля.** Ну, может быть. Но выглядит это, как вставленный в PSD векторный объект. Не знаю кто в этом виноват. Я в таких случаях просто, чтобы не удлинять цикл разработки, не трогаю дизайнера. Я иду на какой-нибудь сайт, где дают иконки и скачиваю похожую иконку, убеждаюсь что она нарисована нормально, что она покрасится нормально и чищу её с помощью SVGO и вставляю в свой спрайт. Так вот мы и живём.

**Лёша.** Знаешь, у нас в самом-самом-самом начале была тоже проблема, что у дизайнера появлялись SVG-объекты, внутри которых был зафигачен `base64` — растровое изображение. Мы этот этап тоже прошли. Я бы на твоём месте не брал это всё на себя, а просто показал бы этому дизайнеру, что в итоге получается. Окей, не в рамках текущего проекта, а просто где-то в фоне, параллельно, за кружкой пива, где угодно. Просто надо показать, что получается и что он делает совсем не то. Он ведь делает не так, как ты ожидаешь, не потому что он хочет так делать, он просто не знает об этом, он не знает о том результате, который он делает. Покажи ему его и он поправит. Сейчас нам дизайнер присылает векторные элементы и они отличные. Мы больше не тратим время на работу с этими элементами.

**Оля.** Ты прав. Я просто думала на Photoshop. Потому что, если каждый раз так в макетах от разных дизайнеров — мне как-то не пришло в голову, что может быть это они делают что-то не так.

**Вадим.** А я в таких ситуациях просто открываю этот векторный объект в иллюстраторе. Можно как-то пробросить в иллюстратор всё это. Если это вставленый объект — можно по нему даблкликнуть, и он откроется в иллюстраторе. А в принципе можно скопировать кривую в иллюстратор и оттуда получить иконку. Ну да, лучше конечно наладить процесс.

## Безопасный SVG

**Вадим.** Мы тут все страшно рады, что SVG существует, что его всё больше и больше в вебе. Но есть один момент, который расстраивает — это то, что SVG не считается таким же форматом графики, как растр. Смотрите, вот у вас есть прекрасная версия вашего логотипа или даже аватарки вашей. Векторная красивая аватарка. Вы идёте в какой-нибудь Twitter и загружаете её, а Twitter говорит: «SVG? Нет, никакого SVG! Только PNG, GIF-дедуля или JPEG». Да он даже WebP не съест — «а что это такое?» В итоге получается, что все сайты и сервисы страшно консервативны с точки зрения форматов графики, хотя поддержать новые казалось бы ничего не стоит. И ладно растр — WebP ещё поддержать можно, если попросить. А с SVG другая история.

На этой неделе был интересный [пост о том, почему в WordPress нельзя загружать SVG](https://bjornjohansen.no/svg-in-wordpress "SVG uploads in WordPress (the Inconvenient Truth)"). Здесь WordPress видимо был взят как самый популярный сервис по созданию блогов и сайтов. Он имеет какие-то безумные 40 или даже больше процентов вообще всех сайтов в интернете — площадка довольно популярная. И вот, на его примере, собственно объяснили, почему в WordPress нельзя загружать SVG. Не потому что WordPress глупый. На самом деле включить поддержку SVG в нём довольно просто. Даже для этого есть специальный плагин, но чуть позже об этом. Дело в том что SVG — это не просто картинка. Как Лёша сказал выше, SVG — не просто плоская штука в которой ничего нет. SVG — это документ, такой же документ, как и ваша HTML-страница. Туда можно импортировать стили, там есть какие-то слои, там есть даже JavaScript. В SVG можно исполнить JavaScript. Там есть ссылки, по которым можно кликать. Это всё гораздо сложнее. И если вы внутри своей аватарки можете исполнить JavaScript — для сервиса это может быть рискованно. А ещё у SVG есть разные режимы отображения с помощью `viewbox`. Это не самый просто формат графики. Но над ним точно стоит работать. WordPress отключил эту возможность по умолчанию из-за безопасности, но есть возможность чистить ваш SVG от подозрительных вещей, от скриптов, от дополнительных вещей, которые ломают его. Для этого [есть плагин](https://wordpress.org/plugins/safe-svg/ "Safe SVG"), поэтому, если вам очень хочется в вашем WordPress иметь SVG — вперёд, поставьте плагин. Но всё равно будьте осторожны, потому что SVG — это специальный формат графики.

**Лёша.** Пока ты это рассказывал, я зашёл в наш issue-трекер и добавил issue о том, что нужно дать возможность пользователям загружать аватары в SVG.

**Лёша.** Вот-вот, делайте все как Лёша.

## CSS-демки

**Лёша.** На этой неделе была замечательная демка, в которой человек показал как можно с помощью обычных палок из веб-технологий собрать индикатор скролл-бара. Дело в том, что я не смог оценить всю красоту этого способа, поскольку я открыл его на iPhone и он там не работал. А вам как этот способ?

**Оля.** Я конечно порадовалась фантазии этого разработчика. Я очень часто хожу по каким-нибудь чужим codepen и думаю: «О боже, как же тебе это в голову то пришло?» Прям завидую. У нас на нашем новостном сайте есть такой вот прогресс-бар, который индицирует чтение статьи, но мы конечно сделали его на JS. Потому что способ, о котором вы говорите, на костылях весь сделан. Его, скорее всего, невозможно будет использовать на длинном сайте, где есть несколько подряд экранов. И наверняка вылезут какие-то баги и помимо отображения на мобильном. Но сам способ очень занятный. Изучая такие вещи мне кажется можно и свою фантазию как-то раскачать, потому что в обычной разработке в голову конечно не приходит, что можно так сделать.

**Вадим.** Ну да, я бы тоже всем рекомендовал критично относиться к демкам. Я вообще не большой любитель демок как таковых, когда люди просто типа, а давайте-ка я сейчас сделаю эту фигню на чистом CSS просто потому что. Это конечно прокачивает определённую фантазию, но вот так широко рассказывать в новостях Веб-стандартов про какие-то крутейшие демки я бы не стал, потому что это провоцирует людей брать и использовать в продакшене код, который написан, чтобы поржать. Сложно объяснить людям, мол никогда не используйте, иначе весь эффект от крутой демки перебьёшь. Поэтому да, это интересная штука. Есть специальные конкурсы, когда нужно в 1 Кб написать JS-скрипт, который делает вам диско-шары, танцы и всё на свете. Я сам участвовал в конкурсе CSS1K, в котором мы все кодили сайт в 1 Кб CSS. Это было интересно. И вы всякие демки делаете на чистом CSS, например, голову Гомера Симпсона. Круто, но это немножко другое.

И насколько я понимаю автор этой демки с прокруткой и прогресс-баром тоже увидел JS-версию и подумал: а не сделаю-ка я на CSS не потому что это, черт подери, то, что нужно делать, а потому что было интересно попробовать. Получилось здорово и я надеюсь вы какие-то технические решения вытащите из этой демки. Но пожалуйста, не используйте такие хрупкие вещи, которые *особенно* не работают на мобильных.

**Лёша.** Знаешь, про демки у меня есть тоже прикольная история. Мы у себя в Академии публикуем всякие интересные штуки, которые делаются на CSS — это просто позволяет новичкам вдохновиться, понять, что CSS и HTML — это серьёзно. Не то, что надо делать такие штуки, а то, что это серьёзно и смотрите какие крутые вещи можно делать, и идти изучать это. То есть, хорошая мотивация, хорошее вдохновение.

Но был один случай, который меня очень сильно насторожил. Человек увидел очередного покемнона на CSS и начал донимать всех в комментариях, чтобы ему подсказали, как ему утащить эту картинку к себе на сайт. У него не получалось. Он не мог понять, как это ему перетащить. Он пытался копировать CSS-код прямо в браузере, и ничего не работало. Он *вообще не понимал* как это работает и что с этим делать. Бывает доходит прямо до такого. Это конечно страшно, но что поделать.

**Вадим.** Но это ещё немножко говорит о состоянии с инструментами сейчас, что у нас всё настолько заинструментировано, что чтобы завести что-то в браузере, нужно: скачайте NodeJS, установите зависимости, запустите Gulp и тогда, если у вас нормальная операционная система и у вас всё завелось, то у вас получится эта несчастная демка.
